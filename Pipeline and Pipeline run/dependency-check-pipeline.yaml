apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: dependency-check-pipeline

spec:
  workspaces:
    - name: report

  params:
    - name: file-url

    - name: language

    - name: manifest-file-path
      default: go.mod

    - name: pkg-installation-directory-path
      default: dependency-directory

    - name: report-file-path
      default: crda-report.json
      
    - name: image

  tasks:
    - name: setup-env
      taskRef:
        name: setup-env
      workspaces:
        - name: report
          workspace: report
      params:
        - name: language
          value: $(params.language)

        - name: file-url
          value: $(params.file-url)

        - name: pkg-installation-directory-path
          value: $(params.pkg-installation-directory-path)

        - name: manifest-file-path
          value: $(params.manifest-file-path)

        - name: image
          value: $(params.image)

    - name: crda-task
      taskRef:
        name: crda-task
      runAfter:
        - setup-env
      workspaces:
        - name: report
          workspace: report
      params:
        - name: language
          value: $(params.language)

        - name: pkg-installation-directory-path
          value: $(params.pkg-installation-directory-path)

        - name: manifest-file-path
          value: $(params.manifest-file-path)

        - name: image
          value: $(params.image)
          
        - name: report-file-path
          value: $(params.report-file-path)