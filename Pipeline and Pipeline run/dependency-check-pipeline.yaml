apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: dependency-check-pipeline

spec:
  workspaces:
    - name: report

  params:
    - name: repository
    - name: pkg-installation-directory-path
      default: dependency-directory
    - name: manifest-file-path
    - name: report-file-path
      default: crda-report.json
    - name: image

  tasks:
    - name: git-clone-repo
      workspaces:
        - name: report
          workspace: report
      taskRef:
        name: git-clone
      params:
        - name: url
          value: $(params.repository)
        - name: deleteExisting
          value: "true"
    - name: setup-env
      taskRef:
        name: setup-env
      runAfter:
        - git-clone-repo
      workspaces:
        - name: report
          workspace: report
      params:
        - name: language
          value: "1"
        - name: file_url
          value: Database-UI-GoServer/go.mod
        - name: pkg-installation-directory-path
          value: $(params.pkg-installation-directory-path)
        - name: manifest-file-path
          value: $(params.manifest-file-path)
        - name: image
          value: $(params.image)

    - name: crda-task
      taskRef:
        name: crda-task
      runAfter:
        - setup-env
      workspaces:
        - name: report
          workspace: report
      params:
        - name: language
          value: "1"
        - name: pkg-installation-directory-path
          value: $(params.pkg-installation-directory-path)
        - name: manifest-file-path
          value: $(params.manifest-file-path)
        - name: image
          value: $(params.image)
        - name: report-file-path
          value: $(params.report-file-path)